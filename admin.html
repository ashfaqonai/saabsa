<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Blog Admin | Saabsa Solutions</title>
    
    <!-- Favicon - Multiple formats for maximum Google compatibility -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" type="image/png" sizes="192x192" href="/patientreeLogo.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/patientreeLogo.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/patientreeLogo.png" />
    <link rel="shortcut icon" href="/favicon.svg" />
    <link rel="apple-touch-icon" sizes="180x180" href="/patientreeLogo.png" />
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-attachment: fixed;
            min-height: 100vh;
            padding: 20px;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .hidden {
            display: none;
        }
        
        .error-message {
            background: #fee;
            color: #c33;
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .success-message {
            background: #efe;
            color: #3c3;
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    
    <!-- Login Screen -->
    <div id="loginScreen" class="flex items-center justify-center min-h-screen">
        <div class="glass-effect p-8 rounded-3xl shadow-2xl max-w-md w-full">
            <h1 class="text-3xl font-black mb-6 text-gray-900 text-center">Blog Admin</h1>
            <p class="text-gray-600 mb-6 text-center">Enter your password to access the admin panel</p>
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="mb-6">
                    <label for="password" class="block text-sm font-semibold text-gray-700 mb-2">Password</label>
                    <input 
                        type="password" 
                        id="password" 
                        required
                        class="w-full p-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                        placeholder="Enter admin password"
                    />
                </div>
                <button 
                    type="submit"
                    class="w-full bg-gradient-to-r from-[#0F3D6E] to-[#F26A21] text-white px-8 py-4 rounded-xl text-lg font-bold shadow-xl hover:shadow-2xl transform hover:scale-105 transition-all"
                >
                    Login
                </button>
            </form>
            <div id="loginError" class="error-message hidden"></div>
            <div class="mt-6 text-center text-sm text-gray-500">
                <p>Password is managed via GitHub repository secrets</p>
                <p class="mt-2 text-xs">Set ADMIN_PASSWORD in Settings &gt; Secrets and variables &gt; Actions</p>
            </div>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="hidden">
        <div class="max-w-4xl mx-auto">
            <div class="glass-effect p-8 rounded-3xl shadow-2xl mb-6">
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-3xl font-black text-gray-900">Blog Admin Panel</h1>
                    <button 
                        onclick="logout()"
                        class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"
                    >
                        Logout
                    </button>
                </div>
                <p class="text-gray-600">Create and manage blog posts for Saabsa Solutions</p>
            </div>

            <!-- Create New Post Form -->
            <div class="glass-effect p-8 rounded-3xl shadow-2xl">
                <h2 class="text-2xl font-bold mb-6 text-gray-900">Create New Blog Post</h2>
                <form id="blogForm" onsubmit="handleSubmit(event)">
                    <div class="mb-6">
                        <label for="title" class="block text-sm font-semibold text-gray-700 mb-2">Title *</label>
                        <input 
                            type="text" 
                            id="title" 
                            required
                            class="w-full p-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                            placeholder="Enter blog post title"
                        />
                    </div>

                    <div class="grid md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label for="date" class="block text-sm font-semibold text-gray-700 mb-2">Date *</label>
                            <input 
                                type="date" 
                                id="date" 
                                required
                                class="w-full p-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                            />
                        </div>
                        <div>
                            <label for="category" class="block text-sm font-semibold text-gray-700 mb-2">Category</label>
                            <input 
                                type="text" 
                                id="category"
                                class="w-full p-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                placeholder="e.g., Healthcare Technology, AI"
                            />
                        </div>
                    </div>

                    <div class="mb-6">
                        <label for="excerpt" class="block text-sm font-semibold text-gray-700 mb-2">Excerpt</label>
                        <textarea 
                            id="excerpt"
                            rows="3"
                            class="w-full p-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none"
                            placeholder="Short description of the blog post (appears in blog listing)"
                        ></textarea>
                    </div>

                    <div class="mb-6">
                        <label for="content" class="block text-sm font-semibold text-gray-700 mb-2">Content (Markdown) *</label>
                        <textarea 
                            id="content" 
                            required
                            rows="15"
                            class="w-full p-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none font-mono text-sm"
                            placeholder="Write your blog post content in Markdown format..."
                        ></textarea>
                        <p class="text-xs text-gray-500 mt-2">Supports Markdown: **bold**, *italic*, # headings, - lists, etc.</p>
                    </div>

                    <div class="flex flex-col sm:flex-row gap-4">
                        <button 
                            type="submit"
                            class="flex-1 bg-gradient-to-r from-[#0F3D6E] to-[#F26A21] text-white px-8 py-4 rounded-xl text-lg font-bold shadow-xl hover:shadow-2xl transform hover:scale-105 transition-all"
                        >
                            Generate Blog Post Files
                        </button>
                        <button 
                            type="button"
                            onclick="previewPost()"
                            class="px-6 py-4 bg-gray-200 text-gray-700 rounded-xl hover:bg-gray-300 transition-colors font-semibold"
                        >
                            Preview
                        </button>
                    </div>
                </form>

                <div id="message" class="mt-6"></div>
            </div>

            <!-- Preview Modal -->
            <div id="previewModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                <div class="glass-effect p-8 rounded-3xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-900">Preview</h2>
                        <button 
                            onclick="closePreview()"
                            class="text-gray-500 hover:text-gray-700 text-2xl"
                        >
                            ×
                        </button>
                    </div>
                    <div id="previewContent" class="prose max-w-none"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Marked.js for Markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <script src="admin-config.js"></script>
    <script>
        // Check if already logged in
        if (localStorage.getItem('adminAuthenticated') === 'true') {
            showAdminPanel();
        }

        function handleLogin(event) {
            event.preventDefault();
            const password = document.getElementById('password').value;
            const errorDiv = document.getElementById('loginError');
            
            // Get password from config (injected from GitHub Secrets at deploy time)
            const adminPassword = window.ADMIN_CONFIG?.password;
            
            if (!adminPassword || adminPassword === '__ADMIN_PASSWORD_PLACEHOLDER__') {
                errorDiv.textContent = 'Admin password not configured. Please set the ADMIN_PASSWORD secret in GitHub repository settings.';
                errorDiv.classList.remove('hidden');
                return;
            }

            if (password === adminPassword) {
                localStorage.setItem('adminAuthenticated', 'true');
                showAdminPanel();
                errorDiv.classList.add('hidden');
            } else {
                errorDiv.textContent = 'Incorrect password. Please try again.';
                errorDiv.classList.remove('hidden');
            }
        }

        function logout() {
            localStorage.removeItem('adminAuthenticated');
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('adminPanel').classList.add('hidden');
            document.getElementById('password').value = '';
        }

        function showAdminPanel() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('adminPanel').classList.remove('hidden');
            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
        }

        function generateSlug(title) {
            return title
                .toLowerCase()
                .replace(/[^a-z0-9]+/g, '-')
                .replace(/(^-|-$)/g, '');
        }

        function handleSubmit(event) {
            event.preventDefault();
            const messageDiv = document.getElementById('message');
            messageDiv.innerHTML = '';

            const title = document.getElementById('title').value;
            const date = document.getElementById('date').value;
            const category = document.getElementById('category').value;
            const excerpt = document.getElementById('excerpt').value;
            const content = document.getElementById('content').value;

            const slug = generateSlug(title);
            const dateObj = new Date(date);
            const formattedDate = dateObj.toISOString().split('T')[0];

            // Generate markdown file content
            const frontMatter = `---
title: "${title.replace(/"/g, '\\"')}"
date: "${formattedDate}"
category: "${category || 'General'}"
excerpt: "${excerpt.replace(/"/g, '\\"')}"
slug: "${slug}"
---

`;
            const markdownContent = frontMatter + content;

            // Create download link for markdown file
            const blob = new Blob([markdownContent], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${formattedDate}-${slug}.md`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            // Generate JSON entry for posts.json
            const postEntry = {
                title: title,
                date: formattedDate,
                category: category || null,
                excerpt: excerpt || null,
                slug: slug
            };

            const jsonBlob = new Blob([JSON.stringify(postEntry, null, 2) + '\n'], { type: 'application/json' });
            const jsonUrl = URL.createObjectURL(jsonBlob);
            const jsonA = document.createElement('a');
            jsonA.href = jsonUrl;
            jsonA.download = `${slug}-entry.json`;
            document.body.appendChild(jsonA);
            jsonA.click();
            document.body.removeChild(jsonA);
            URL.revokeObjectURL(jsonUrl);

            // Show success message with instructions
            messageDiv.innerHTML = `
                <div class="success-message">
                    <h3 class="font-bold mb-2">✓ Blog post files generated successfully!</h3>
                    <p class="mb-4">Two files have been downloaded:</p>
                    <ol class="list-decimal list-inside mb-4 space-y-2">
                        <li><strong>${formattedDate}-${slug}.md</strong> - The blog post content</li>
                        <li><strong>${slug}-entry.json</strong> - The metadata entry</li>
                    </ol>
                    <p class="mb-4 font-semibold">Next steps:</p>
                    <ol class="list-decimal list-inside space-y-2 mb-4">
                        <li>Save the markdown file to <code class="bg-gray-100 px-2 py-1 rounded">_posts/${formattedDate}-${slug}.md</code></li>
                        <li>Add the JSON entry to <code class="bg-gray-100 px-2 py-1 rounded">_posts/posts.json</code> (add it to the "posts" array)</li>
                        <li>Create <code class="bg-gray-100 px-2 py-1 rounded">blog-post.html?slug=${slug}</code> or update the blog post template</li>
                        <li>Commit and push to GitHub</li>
                    </ol>
                    <p class="text-sm text-gray-600">The blog post will appear on your site after deployment.</p>
                </div>
            `;

            // Reset form
            document.getElementById('blogForm').reset();
            document.getElementById('date').value = new Date().toISOString().split('T')[0];
        }

        function previewPost() {
            const title = document.getElementById('title').value;
            const date = document.getElementById('date').value;
            const category = document.getElementById('category').value;
            const content = document.getElementById('content').value;

            if (!title || !content) {
                alert('Please fill in title and content to preview');
                return;
            }

            const previewContent = document.getElementById('previewContent');
            const formattedDate = new Date(date).toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });

            let html = `
                <article>
                    <div class="mb-4 text-sm text-gray-500">
                        <time>${formattedDate}</time>
                        ${category ? `<span class="ml-4 px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-xs font-semibold">${category}</span>` : ''}
                    </div>
                    <h1 class="text-4xl font-bold mb-6 text-gray-900">${title}</h1>
                    <div class="blog-content">
                        ${marked.parse(content)}
                    </div>
                </article>
            `;

            previewContent.innerHTML = html;
            document.getElementById('previewModal').classList.remove('hidden');
        }

        function closePreview() {
            document.getElementById('previewModal').classList.add('hidden');
        }
    </script>
</body>
</html>

